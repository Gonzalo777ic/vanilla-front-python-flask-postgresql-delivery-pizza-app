{% extends 'layout.html' %}

{% block title %}Checkout{% endblock %}

{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/cart.css') }}">

<h1>Checkout</h1>

<div class="checkout-form">
    <h3>Detalles del Pago</h3>
    <form method="POST" action="{{ url_for('views.buy') }}">
        <input type="hidden" name="user_id" value="{{ user.id }}">

        <label for="payment_method">Método de pago:</label>
        <select name="payment_method" id="payment_method" required>
            <option value="1">Efectivo</option>
            <option value="2">Tarjeta</option>
            <option value="3">Yape</option>
        </select>

        <label for="shipping_address">Dirección de Envío:</label>

        <div class="new-address-form">
            <h4>¿No tienes una dirección? Agrega una nueva:</h4>
            <label for="new_address_line_1">Dirección:</label>
            <input type="text" id="new_address_line_1" name="new_address_line_1" placeholder="Calle, número, etc." required>

            <label for="new_city">Ciudad:</label>
            <input type="text" id="new_city" name="new_city" placeholder="Ciudad" value="Lima" required>

            <label for="new_postal_code">Código Postal:</label>
            <input type="text" id="new_postal_code" name="new_postal_code" placeholder="Código Postal" required>

            <label for="new_country">País:</label>
            <input type="text" id="new_country" name="new_country" placeholder="País" value="Perú" required>
            <div class="saved-addresses">
                <h3>Direcciones Registradas</h3>
                {% if shipping_addresses %}
                <ul>
                    {% for address in shipping_addresses %}
                    <li class="saved-address" 
                        data-line="{{ address.address_line_1 }}" 
                        data-city="{{ address.city }}" 
                        data-postal="{{ address.postal_code }}" 
                        data-country="{{ address.country }}">
                        {{ address.address_line_1 }}, {{ address.city }}, {{ address.postal_code }}, {{ address.country }}
                    </li>
                    {% endfor %}
                </ul>
                {% else %}
                <p>No tienes direcciones registradas.</p>
                {% endif %}
            </div>
            
            <button type="submit" name="action" value="add_address">Agregar Dirección</button>
            <button button type="submit">Completar Compra</button>

        </div>
    </form>
</div>

<!-- Lista de direcciones registradas -->


</div>

<script>
    // Seleccionar todas las direcciones guardadas
    const savedAddresses = document.querySelectorAll('.saved-address');

    // Añadir un evento click a cada dirección guardada
    savedAddresses.forEach(address => {
        address.addEventListener('click', () => {
            // Leer los datos de la dirección seleccionada
            const line1 = address.dataset.line1;
            const city = address.dataset.city;
            const postal = address.dataset.postal;
            const country = address.dataset.country;

            // Rellenar los campos del formulario con estos datos
            document.getElementById('new_address_line_1').value = line1 || '';
            document.getElementById('new_city').value = city || 'Lima';
            document.getElementById('new_postal_code').value = postal || '';
            document.getElementById('new_country').value = country || 'Perú';
        });
    });
</script>

{% include 'footer.html' %}

{% endblock %}